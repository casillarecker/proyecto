
package Controladores;


import Datos_Clases.*;
import Modelos_BBDD.*;
import Vista.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.List;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;


public class Producto_Controlador extends MouseAdapter implements ActionListener{
    
    From_Producto_Grafica producto_Graficas;
    Producto_base producto_base = new Producto_base();
    Producto_D pd = new Producto_D();
    DefaultTableModel tableModels = new DefaultTableModel();
    int id ;

    public Producto_Controlador(From_Producto_Grafica pf) {
        this.producto_Graficas= pf;
        
        listarProducto();
        
        //eventos 
        pf.btnagregarproducto.addActionListener(this);
       //+ this.producto_From.btnagregarproducto.addActionListener(this);
        this.producto_Graficas.btnnuevoproducto.addActionListener(this);
        this.producto_Graficas.btnmodificarproducto.addActionListener(this);
        this.producto_Graficas.btneliminarproducto.addActionListener(this);
        
        this.producto_Graficas.tablaproducto.addMouseListener(this);//pare recargar los campos del fro, mouse clicked
                               
        
                                           
    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

    @Override
    public void actionPerformed(ActionEvent t) {
        if(producto_Graficas.btnagregarproducto==t.getSource()){
            try {
                agregaProductos();
                limpiarTablaProducto(producto_Graficas.tablaproducto);
                listarProducto();
              
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null,"No se pudo agregar el producto. ¿ingrese datos correctos\n precio : 34.7");
            }
        }else if(producto_Graficas.btnmodificarproducto==t.getSource()){
            try {
                actualizarProducto();
                limpiarTablaProducto(producto_Graficas.tablaproducto);
                listarProducto();
                
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null,"No se pudo actualizar el producto");
            }
        }else if(producto_Graficas.btneliminarproducto==t.getSource()){
            try {
                eliminarProducto();
                limpiarTablaProducto(producto_Graficas.tablaproducto);
                listarProducto();
              
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null,"No se pudo eliminare el producto");
            }
        }else if(producto_Graficas.btnnuevoproducto==t.getSource()){
            try {
                nuevoproducto();
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null,"No se pudo crear nuevo producto");
            }
            
        }
        
        
        
    }
    ///recagar campos 

   
    @Override
    public void mouseClicked (MouseEvent e){
        int fila = producto_Graficas.tablaproducto.getSelectedRow();
        
        if(fila==-1){
            JOptionPane.showMessageDialog(null,"Debe seleccionar una fila");
        }else{
            id = Integer.parseInt(producto_Graficas.tablaproducto.getValueAt(fila,0).toString());
            //para actulizar 
            String nombre=producto_Graficas.tablaproducto.getValueAt(fila, 1).toString();
            String precio=producto_Graficas.tablaproducto.getValueAt(fila,2).toString();
            String stock = producto_Graficas.tablaproducto.getValueAt(fila,3).toString();
            
            producto_Graficas.txtnombre.setText(nombre);
            producto_Graficas.txtprecio.setText(precio);
            producto_Graficas.txtstock.setText(stock);
         
        }
        
    }
    
    
    //----------------------------------metodos de los eventos 
    
    public void agregaProductos(){
        String nombre = producto_Graficas.txtnombre.getText();
        double precio= Double.parseDouble(producto_Graficas.txtprecio.getText());
        int stock = Integer.parseInt(producto_Graficas.txtstock.getText());
        
        Object object []= new Object[3];
        //el id es automen
        object[0]=nombre;
        object[1]=precio;
        object[2]=stock;
        
        producto_base.insertarProducto(object);
        
    }
    
    public void actualizarProducto(){
        int fila = producto_Graficas.tablaproducto.getSelectedRow();
        if(fila==-1){
           JOptionPane.showMessageDialog(null,"Debe seleccionar una fila"); 
        }else {
            String nombre  = producto_Graficas.txtnombre.getText();
            double precio = Double.parseDouble(producto_Graficas.txtprecio.getText());
            int stock = Integer.parseInt(producto_Graficas.txtstock.getText());
            Object o []= new Object[4];
            o[0]=nombre;
            o[1]=precio;
            o[2]=stock;
            o[3]=id;
            
            producto_base.actulizarProducto(o);
            
        }
    }
    public void eliminarProducto(){
        int fila = producto_Graficas.tablaproducto.getSelectedRow();
        if(fila==-1){
            JOptionPane.showMessageDialog(null,"Debe seleccionar una fila"); 
        }else{
            producto_base.eliminarProducto(id);
        }
    }
    public  void nuevoproducto (){
        producto_Graficas.txtnombre.setText("");
        producto_Graficas.txtprecio.setText("");
        producto_Graficas.txtstock.setText("");
        
    }
    public void limpiarTablaProducto(JTable tablaex){
         try {
             int fila = tablaex.getRowCount();
             for(int i = 0 ; fila >i;i++){
                 tableModels.removeRow(0);
             }
         } catch (Exception e) {
         JOptionPane.showMessageDialog(null,"Error al limpiar la tabla.");
         }
     }
     public void listarProducto (){
         
        
        List<Producto_D> lista = producto_base.listarProducto();
        tableModels = (DefaultTableModel)producto_Graficas.tablaproducto.getModel();
        Object objects[] = new Object[4];
        for (int i = 0; i < lista.size(); i++){
            objects[0]=lista.get(i).getIdPro();
            objects[1]=lista.get(i).getNom();
            objects[2]=lista.get(i).getPrecio();
            objects[3]=lista.get(i).getStock();
            
            tableModels.addRow(objects);
            
        }
        
        producto_Graficas.tablaproducto.setModel(tableModels);
    }
    
}
